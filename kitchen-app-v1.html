<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="kitchen-app-style.css"/>
  <title>Kitchen App</title>
</head>
<body>
  <div class="background">
    <div class="app">
      <div class="phone">

        <!-- HOME TAB -->
        <div class="tab-content active" id="tab1">
          <h2 class="tab-title">Home</h2>
          
          <!-- Quick Actions -->
          <div class="quick-actions">
            <button onclick="showTab(2)">‚ûï Add to Inventory</button>
            <button onclick="showTab(3)">üìù Add to Shopping List</button>
            <button onclick="showTab(4)">üîç Find Recipe</button>
          </div>

          <!-- Expiring Items Section -->
          <div class="home-section">
            <h3>‚ö†Ô∏è Items Expiring Soon</h3>
            <div class="expiring-items" id="expiring-items"></div>
          </div>

          <!-- Low Inventory Section -->
          <div class="home-section">
            <h3>üìâ Low Inventory</h3>
            <div class="low-inventory" id="low-inventory"></div>
          </div>

          <!-- Recipe Suggestions -->
          <div class="home-section">
            <h3>üë®‚Äçüç≥ Suggested Recipes</h3>
            <div class="recipe-suggestions" id="recipe-suggestions"></div>
          </div>

          <!-- Quick Inventory Overview -->
          <div class="home-section">
            <h3>üì¶ Inventory Overview</h3>
            <div class="inventory-overview" id="inventory-overview"></div>
          </div>
        </div>

        <!-- INVENTORY TAB -->
        <div class="tab-content" id="tab2">
          <h2 class="tab-title">Inventory</h2>
          <div class="inventory-grid-view">
            <div class="new-inventory">
              <input type="text" id="new-inventory-name" placeholder="New Inventory Name" required />
              <button onclick="createNewInventory()">‚ûï</button>
            </div>
            <div class="inventory-grid" id="inventory-grid"></div>
          </div>
          <div class="inventory-content" style="display: none;">
            <button onclick="showGrid2()">‚¨Ö</button>
            <h3 id="current-inventory-name"></h3>
            <form id="inventory-form" onsubmit="addToInventory2(event)">
              <input type="text" id="inv-item" placeholder="Item" required />
              <input type="number" id="inv-quantity" placeholder="Quantity" min="0.1" step="0.1" required />
              <select id="inv-measure" required>
                <option value="quantity">Quantity</option>
                <option value="cups">Cups</option>
                <option value="tbsp">Tablespoons</option>
                <option value="tsp">Teaspoons</option>
                <option value="oz">Ounces</option>
                <option value="lbs">Pounds</option>
                <option value="g">Grams</option>
                <option value="ml">Milliliters</option>
                <option value="slices">Slices</option>
              </select>
              <input type="date" id="inv-expiry" placeholder="Expiration Date" />
              <button type="submit">‚ûï</button>
            </form>
            <div class="inventory-items-container">
              <h4>Items in this inventory:</h4>
              <ul id="inventory"></ul>
            </div>
          </div>
        </div>

        <!-- SHOPPING LIST TAB -->
        <div class="tab-content" id="tab3">
          <h2 class="tab-title">Shopping Lists</h2>
          <button class="add-item-btn" onclick="showAddItemForm()">‚ûï Add Item</button>
          <div class="shopping-list-box">
            <h3>Items Needed:</h3>
            <ul id="shopping-list-items"></ul>
            <div class="purchase-controls">
              <button class="purchase-btn" onclick="handlePurchasedItems()" disabled>Move to Inventory</button>
            </div>
          </div>
        </div>

        <!-- RECIPES TAB -->
        <div class="tab-content" id="tab4">
          <h2 class="tab-title">Recipes</h2>
          <button onclick="renderRecipes()">üîÑ Refresh</button>
          <button onclick="openRecipeModal()">‚ûï Add Recipe</button>
          <ul id="recipe-list"></ul>
        </div>

        <!-- PROFILE TAB -->
        <div class="tab-content" id="tab5">
          <h2 class="tab-title">Profile</h2>
        </div>

        <!-- TAB BAR -->
        <div class="tab-bar">
          <button class="active" onclick="showTab(1)">üè†<br>Home</button>
          <button onclick="showTab(2)">ü•ö<br>Inventory</button>
          <button onclick="showTab(3)">üìã<br>Shopping List</button>
          <button onclick="showTab(4)">üìñ<br>Recipes</button>
          <button onclick="showTab(5)">üë§<br>Profile</button>
        </div>

        <!-- Recipe Modal -->
        <div id="recipeModal" class="modal">
          <div class="modal-content">
            <h3>Add New Recipe</h3>
            <input type="text" id="new-recipe-name" placeholder="Recipe Name">
            <textarea id="new-recipe-instructions" placeholder="Enter recipe instructions"></textarea>
            <input type="text" id="new-ingredient" placeholder="Enter ingredient (e.g., '2 cups flour')">
            <button onclick="addIngredientToNewRecipe()">Add Ingredient</button>
            <ul id="new-ingredients-list"></ul>
            <button onclick="saveNewRecipe()">Done</button>
            <button onclick="closeRecipeModal()">Cancel</button>
          </div>
        </div>

        <!-- Inventory Modal -->
        <div id="inventoryModal" class="modal">
          <div class="modal-content">
            <p>Select inventory to move item into:</p>
            <div id="inventory-buttons"></div>
            <button onclick="closeInventoryModal()">Cancel</button>
          </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="modal">
          <div class="modal-content">
            <h3 id="confirmTitle">Confirm Action</h3>
            <p id="confirmMessage"></p>
            <div class="confirm-buttons">
              <button onclick="handleConfirmAction()" id="confirmYes">Yes</button>
              <button onclick="closeConfirmModal()">No</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const shoppingList = [
      { name: "Milk", quantity: 1, measure: "quantity" },
      { name: "Bread", quantity: 2, measure: "slices" },
      { name: "Eggs", quantity: 12, measure: "quantity" }
    ];
    const recipes = [
      { 
        name: "Omelette", 
        ingredients: [
          { name: "Eggs", quantity: 2, unit: "whole" },
          { name: "Milk", quantity: 2, unit: "tbsp" },
          { name: "Salt", quantity: 0.25, unit: "tsp" }
        ],
        instructions: "1. Whisk eggs with milk and salt\n2. Heat pan with butter\n3. Pour mixture and cook until set\n4. Fold and serve"
      },
      { 
        name: "Pasta", 
        ingredients: [
          { name: "Pasta", quantity: 8, unit: "oz" },
          { name: "Tomato Sauce", quantity: 1, unit: "cup" },
          { name: "Olive Oil", quantity: 2, unit: "tbsp" }
        ],
        instructions: "1. Boil pasta according to package\n2. Heat sauce in separate pan\n3. Drain pasta and mix with sauce\n4. Drizzle with olive oil"
      },
      { 
        name: "Salad", 
        ingredients: [
          { name: "Lettuce", quantity: 1, unit: "head" },
          { name: "Tomato", quantity: 2, unit: "whole" },
          { name: "Cucumber", quantity: 1, unit: "whole" }
        ],
        instructions: "1. Wash and chop vegetables\n2. Combine in large bowl\n3. Add dressing of choice\n4. Toss and serve"
      }
    ];
    let newRecipeIngredients = [];
    const inventories = { Fridge: [] };
    let currentInventory = 'Fridge';
    let inventory = inventories[currentInventory];
    let confirmCallback = null;
    let confirmData = null;

    function showTab(tabNum) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.getElementById('tab' + tabNum).classList.add('active');
      document.querySelectorAll('.tab-bar button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-bar button')[tabNum - 1].classList.add('active');
      if (tabNum === 1) {
        updateHomePage();
      }
      if (tabNum === 4) renderRecipes();
    }

    function updateGrid2() {
      const grid = document.getElementById('inventory-grid');
      grid.innerHTML = '';
      for (const name in inventories) {
        const div = document.createElement('div');
        div.className = 'inventory-item';
        div.textContent = name;
        div.onclick = () => showInventory(name);
        grid.appendChild(div);
      }
    }

    function createNewInventory() {
      const name = document.getElementById('new-inventory-name').value.trim();
      if (name && !inventories[name]) {
        inventories[name] = [];
        updateGrid2();
      }
    }

    function showInventory(name) {
      currentInventory = name;
      inventory = inventories[name];
      document.querySelector('.inventory-grid-view').style.display = 'none';
      document.querySelector('.inventory-content').style.display = 'block';
      document.getElementById('current-inventory-name').textContent = name;
      updateInventory();
    }

    function showGrid2() {
      document.querySelector('.inventory-grid-view').style.display = 'block';
      document.querySelector('.inventory-content').style.display = 'none';
    }

    function addToInventory2(event) {
      event.preventDefault();
      const item = document.getElementById('inv-item').value.trim();
      let quantity = parseFloat(document.getElementById('inv-quantity').value || '1');
      const measure = document.getElementById('inv-measure').value;
      const expiry = document.getElementById('inv-expiry').value;
      const existing = inventory.find(i => i.item.toLowerCase() === item.toLowerCase() && i.measure === measure);
      if (existing) existing.quantity += quantity;
      else inventory.push({ item, quantity, measure, expiry });
      updateInventory();
      updateCurrentItemsList();
      document.getElementById('inventory-form').reset();
    }

    function updateInventory() {
      const list = document.getElementById('inventory');
      if (!list) return; // Guard against null if not on inventory tab
      
      list.innerHTML = '';
      if (!inventory) return; // Guard against null inventory
      
      inventory.forEach((entry, index) => {
        const li = document.createElement('li');
        const measureText = entry.measure === 'quantity' ? '' : ` ${entry.measure}`;
        
        // Create item display
        const itemDisplay = document.createElement('div');
        itemDisplay.className = 'item-display';
        itemDisplay.innerHTML = `
          <span class="item-name">${entry.item}</span>
          <span class="item-quantity">(${entry.quantity}${measureText})</span>
        `;
        
        // Create edit form (hidden by default)
        const editForm = document.createElement('div');
        editForm.className = 'edit-form';
        editForm.style.display = 'none';
        editForm.innerHTML = `
          <input type="text" class="edit-name" value="${entry.item}" placeholder="Item name" />
          <input type="number" class="edit-quantity" value="${entry.quantity}" min="0.1" step="0.1" placeholder="Quantity" />
          <select class="edit-measure">
            <option value="quantity" ${entry.measure === 'quantity' ? 'selected' : ''}>Quantity</option>
            <option value="cups" ${entry.measure === 'cups' ? 'selected' : ''}>Cups</option>
            <option value="tbsp" ${entry.measure === 'tbsp' ? 'selected' : ''}>Tablespoons</option>
            <option value="tsp" ${entry.measure === 'tsp' ? 'selected' : ''}>Teaspoons</option>
            <option value="oz" ${entry.measure === 'oz' ? 'selected' : ''}>Ounces</option>
            <option value="lbs" ${entry.measure === 'lbs' ? 'selected' : ''}>Pounds</option>
            <option value="g" ${entry.measure === 'g' ? 'selected' : ''}>Grams</option>
            <option value="ml" ${entry.measure === 'ml' ? 'selected' : ''}>Milliliters</option>
            <option value="slices" ${entry.measure === 'slices' ? 'selected' : ''}>Slices</option>
          </select>
          <button class="save-edit">Save</button>
          <button class="cancel-edit">Cancel</button>
        `;
        
        // Create controls container
        const controls = document.createElement('div');
        controls.className = 'item-controls';
        
        // Edit button
        const editBtn = document.createElement('button');
        editBtn.textContent = '‚úèÔ∏è';
        editBtn.onclick = () => {
          itemDisplay.style.display = 'none';
          editForm.style.display = 'flex';
          controls.style.display = 'none';
        };
        
        // Consume button
        const consumeBtn = document.createElement('button');
        consumeBtn.textContent = 'üçΩÔ∏è';
        consumeBtn.onclick = () => {
          itemDisplay.style.display = 'none';
          consumeForm.style.display = 'flex';
          controls.style.display = 'none';
        };
        
        // Remove button
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'üóëÔ∏è';
        removeBtn.onclick = () => {
          inventory.splice(index, 1);
          updateInventory();
          updateCurrentItemsList();
        };
        
        controls.append(editBtn, consumeBtn, removeBtn);
        li.append(itemDisplay, editForm, controls);
        list.appendChild(li);
      });
    }

    function updateCurrentItemsList() {
      const list = document.getElementById("current-items-list");
      list.innerHTML = "";
      for (const invName in inventories) {
        inventories[invName].forEach(entry => {
          const li = document.createElement("li");
          const measureText = entry.measure === 'quantity' ? '' : ` ${entry.measure}`;
          const expiryText = entry.expiry ? ` - Expires: ${new Date(entry.expiry).toLocaleDateString()}` : '';
          li.textContent = `${entry.item} (${entry.quantity}${measureText})${expiryText} - ${invName}`;
          
          // Add expiry status class if item has expiry date
          if (entry.expiry) {
            const today = new Date();
            const expiryDate = new Date(entry.expiry);
            const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
            
            if (daysUntilExpiry < 0) {
              li.classList.add('expired');
            } else if (daysUntilExpiry <= 3) {
              li.classList.add('expiring-soon');
            }
          }
          
          list.appendChild(li);
        });
      }
    }

    function updateShoppingList() {
      const ul = document.getElementById("shopping-list-items");
      ul.innerHTML = "";
      shoppingList.forEach((item, index) => {
        const li = document.createElement("li");
        
        // Create checkbox
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'item-checkbox';
        checkbox.onchange = () => updatePurchaseButton();
        
        // Create item display
        const itemDisplay = document.createElement('div');
        itemDisplay.className = 'item-display';
        const measureText = item.measure === 'quantity' ? '' : ` ${item.measure}`;
        itemDisplay.innerHTML = `
          <span class="item-name">${item.name}</span>
          <span class="item-quantity">(${item.quantity}${measureText})</span>
        `;
        
        // Create edit form (hidden by default)
        const editForm = document.createElement('div');
        editForm.className = 'edit-form';
        editForm.style.display = 'none';
        editForm.innerHTML = `
          <input type="text" class="edit-name" value="${item.name}" placeholder="Item name" />
          <input type="number" class="edit-quantity" value="${item.quantity}" min="0.1" step="0.1" placeholder="Quantity" />
          <select class="edit-measure">
            <option value="quantity" ${item.measure === 'quantity' ? 'selected' : ''}>Quantity</option>
            <option value="cups" ${item.measure === 'cups' ? 'selected' : ''}>Cups</option>
            <option value="tbsp" ${item.measure === 'tbsp' ? 'selected' : ''}>Tablespoons</option>
            <option value="tsp" ${item.measure === 'tsp' ? 'selected' : ''}>Teaspoons</option>
            <option value="oz" ${item.measure === 'oz' ? 'selected' : ''}>Ounces</option>
            <option value="lbs" ${item.measure === 'lbs' ? 'selected' : ''}>Pounds</option>
            <option value="g" ${item.measure === 'g' ? 'selected' : ''}>Grams</option>
            <option value="ml" ${item.measure === 'ml' ? 'selected' : ''}>Milliliters</option>
            <option value="slices" ${item.measure === 'slices' ? 'selected' : ''}>Slices</option>
          </select>
          <button class="save-edit">Save</button>
          <button class="cancel-edit">Cancel</button>
        `;
        
        // Create controls container
        const controls = document.createElement('div');
        controls.className = 'item-controls';
        
        // Edit button
        const editBtn = document.createElement('button');
        editBtn.textContent = '‚úèÔ∏è';
        editBtn.onclick = () => {
          itemDisplay.style.display = 'none';
          editForm.style.display = 'flex';
          controls.style.display = 'none';
        };
        
        // Remove button
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'üóëÔ∏è';
        removeBtn.onclick = () => {
          shoppingList.splice(index, 1);
          updateShoppingList();
        };
        
        // Add event listeners for edit form
        editForm.querySelector('.save-edit').onclick = () => {
          const newName = editForm.querySelector('.edit-name').value.trim();
          const newQuantity = parseFloat(editForm.querySelector('.edit-quantity').value) || 0.1;
          const newMeasure = editForm.querySelector('.edit-measure').value;
          if (newName && newQuantity > 0) {
            shoppingList[index] = {
              name: newName,
              quantity: newQuantity,
              measure: newMeasure
            };
            updateShoppingList();
          }
        };
        
        editForm.querySelector('.cancel-edit').onclick = () => {
          itemDisplay.style.display = 'flex';
          editForm.style.display = 'none';
          controls.style.display = 'flex';
        };
        
        controls.append(editBtn, removeBtn);
        li.append(checkbox, itemDisplay, editForm, controls);
        ul.appendChild(li);
      });
    }

    function updatePurchaseButton() {
      const checkedItems = document.querySelectorAll('.item-checkbox:checked');
      const purchaseBtn = document.querySelector('.purchase-btn');
      purchaseBtn.disabled = checkedItems.length === 0;
    }

    function handlePurchasedItems() {
      const checkedBoxes = document.querySelectorAll('.item-checkbox:checked');
      const itemsToMove = [];
      
      // Collect checked items
      checkedBoxes.forEach(checkbox => {
        const li = checkbox.closest('li');
        const index = Array.from(li.parentNode.children).indexOf(li);
        itemsToMove.push(shoppingList[index]);
      });
      
      // Create inventory selection modal
      const modal = document.getElementById("inventoryModal");
      const container = document.getElementById("inventory-buttons");
      container.innerHTML = "";
      
      // Add inventory selection buttons
      for (const name in inventories) {
        const btn = document.createElement("button");
        btn.textContent = name;
        btn.onclick = () => {
          // Move items to selected inventory
          itemsToMove.forEach(item => {
            // Check if item already exists in inventory
            const existingItem = inventories[name].find(i => 
              i.item.toLowerCase() === item.name.toLowerCase() && 
              i.measure === item.measure
            );
            
            if (existingItem) {
              // If item exists, add to its quantity
              existingItem.quantity += item.quantity;
            } else {
              // If item doesn't exist, add new entry
              inventories[name].push({
                item: item.name,
                quantity: item.quantity,
                measure: item.measure
              });
            }
          });
          
          // Remove moved items from shopping list
          const indicesToRemove = [];
          checkedBoxes.forEach(checkbox => {
            const li = checkbox.closest('li');
            const index = Array.from(li.parentNode.children).indexOf(li);
            indicesToRemove.push(index);
          });
          
          // Remove items in reverse order to avoid index issues
          indicesToRemove.sort((a, b) => b - a).forEach(index => {
            shoppingList.splice(index, 1);
          });
          
          modal.classList.remove("active");
          updateShoppingList();
          updateGrid2(); // Update inventory grid
          if (currentInventory === name) {
            updateInventory(); // Update current inventory view
          }
          updateCurrentItemsList();
        };
        container.appendChild(btn);
      }
      
      modal.classList.add("active");
    }

    function showAddItemForm() {
      const ul = document.getElementById("shopping-list-items");
      const li = document.createElement("li");
      li.className = "new-item-form";
      
      const form = document.createElement('div');
      form.className = 'edit-form';
      form.innerHTML = `
        <input type="text" class="edit-name" placeholder="Enter new item" />
        <input type="number" class="edit-quantity" value="1" min="0.1" step="0.1" placeholder="Quantity" />
        <select class="edit-measure">
          <option value="quantity">Quantity</option>
          <option value="cups">Cups</option>
          <option value="tbsp">Tablespoons</option>
          <option value="tsp">Teaspoons</option>
          <option value="oz">Ounces</option>
          <option value="lbs">Pounds</option>
          <option value="g">Grams</option>
          <option value="ml">Milliliters</option>
          <option value="slices">Slices</option>
        </select>
        <button class="save-edit">Add</button>
        <button class="cancel-edit">Cancel</button>
      `;
      
      form.querySelector('.save-edit').onclick = () => {
        const newName = form.querySelector('.edit-name').value.trim();
        const newQuantity = parseFloat(form.querySelector('.edit-quantity').value) || 0.1;
        const newMeasure = form.querySelector('.edit-measure').value;
        if (newName && newQuantity > 0) {
          shoppingList.push({
            name: newName,
            quantity: newQuantity,
            measure: newMeasure
          });
          updateShoppingList();
        }
      };
      
      form.querySelector('.cancel-edit').onclick = () => {
        li.remove();
      };
      
      li.appendChild(form);
      ul.insertBefore(li, ul.firstChild);
      form.querySelector('.edit-name').focus();
    }

    function getAllInventoryItems() {
      const items = new Set();
      for (const invName in inventories) {
        inventories[invName].forEach(entry => items.add(entry.item.toLowerCase()));
      }
      return items;
    }

    function renderRecipes() {
      const list = document.getElementById("recipe-list");
      list.innerHTML = '';
      const inventoryItems = getAllInventoryItems();
      
      recipes.forEach((recipe, index) => {
        const li = document.createElement("li");
        li.className = "recipe-card";
        
        // Recipe header with name and availability
        const header = document.createElement("div");
        header.className = "recipe-header";
        const hasAll = recipe.ingredients.every(i => inventoryItems.has(i.name.toLowerCase()));
        header.innerHTML = `
          <h3>${recipe.name}</h3>
          <span class="availability ${hasAll ? 'available' : 'missing'}">
            ${hasAll ? '‚úÖ All ingredients available' : '‚ùå Missing ingredients'}
          </span>
        `;
        
        // Ingredients section
        const ingredientsSection = document.createElement("div");
        ingredientsSection.className = "recipe-section";
        ingredientsSection.innerHTML = `
          <h4>Ingredients:</h4>
          <ul class="ingredients-list">
            ${recipe.ingredients.map(ing => `
              <li class="${inventoryItems.has(ing.name.toLowerCase()) ? 'available' : 'missing'}">
                ${ing.quantity} ${ing.unit} ${ing.name}
              </li>
            `).join('')}
          </ul>
        `;
        
        // Instructions section
        const instructionsSection = document.createElement("div");
        instructionsSection.className = "recipe-section";
        instructionsSection.innerHTML = `
          <h4>Instructions:</h4>
          <div class="instructions">${recipe.instructions.replace(/\n/g, '<br>')}</div>
        `;
        
        // Recipe controls
        const controls = document.createElement("div");
        controls.className = "recipe-controls";
        controls.innerHTML = `
          <button onclick="editRecipe(${index})" class="edit-btn">‚úèÔ∏è Edit</button>
          <button onclick="deleteRecipe(${index})" class="delete-btn">üóëÔ∏è Delete</button>
        `;
        
        li.append(header, ingredientsSection, instructionsSection, controls);
        list.appendChild(li);
      });
    }

    function editRecipe(index) {
      const recipe = recipes[index];
      document.getElementById("new-recipe-name").value = recipe.name;
      document.getElementById("new-recipe-instructions").value = recipe.instructions;
      document.getElementById("new-ingredients-list").innerHTML = '';
      newRecipeIngredients = recipe.ingredients.map(ing => ({
        name: ing.name,
        quantity: ing.quantity,
        unit: ing.unit
      }));
      
      // Add ingredients to the list
      newRecipeIngredients.forEach(ing => {
        const li = document.createElement("li");
        li.textContent = `${ing.quantity} ${ing.unit} ${ing.name}`;
        document.getElementById("new-ingredients-list").appendChild(li);
      });
      
      document.getElementById("recipeModal").classList.add("active");
    }

    function showConfirmModal(title, message, callback, data = null) {
      document.getElementById("confirmTitle").textContent = title;
      document.getElementById("confirmMessage").textContent = message;
      confirmCallback = callback;
      confirmData = data;
      document.getElementById("confirmModal").classList.add("active");
    }

    function closeConfirmModal() {
      document.getElementById("confirmModal").classList.remove("active");
      confirmCallback = null;
      confirmData = null;
    }

    function handleConfirmAction() {
      if (confirmCallback) {
        confirmCallback(confirmData);
      }
      closeConfirmModal();
    }

    function deleteRecipe(index) {
      showConfirmModal(
        "Delete Recipe",
        "Are you sure you want to delete this recipe?",
        (index) => {
          recipes.splice(index, 1);
          renderRecipes();
        },
        index
      );
    }

    function openRecipeModal() {
      newRecipeIngredients = [];
      document.getElementById("new-recipe-name").value = '';
      document.getElementById("new-recipe-instructions").value = '';
      document.getElementById("new-ingredient").value = '';
      document.getElementById("new-ingredients-list").innerHTML = '';
      document.getElementById("recipeModal").classList.add("active");
    }

    function closeRecipeModal() {
      document.getElementById("recipeModal").classList.remove("active");
    }

    function addIngredientToNewRecipe() {
      const input = document.getElementById("new-ingredient");
      const ing = input.value.trim();
      if (ing) {
        // Parse ingredient string (format: "quantity unit name")
        const parts = ing.split(" ");
        if (parts.length >= 3) {
          const quantity = parseFloat(parts[0]);
          const unit = parts[1].toLowerCase();
          const name = parts.slice(2).join(" ");
          
          // Validate unit
          const validUnits = ['quantity', 'cups', 'tbsp', 'tsp', 'oz', 'lbs', 'g', 'ml', 'slices'];
          if (!isNaN(quantity) && validUnits.includes(unit) && name) {
            newRecipeIngredients.push({ name, quantity, unit });
            const li = document.createElement("li");
            li.textContent = `${quantity} ${unit} ${name}`;
            document.getElementById("new-ingredients-list").appendChild(li);
            input.value = '';
          } else {
            showConfirmModal(
              "Invalid Input",
              "Please enter ingredient in format: quantity unit name\nValid units: quantity, cups, tbsp, tsp, oz, lbs, g, ml, slices",
              () => {}
            );
          }
        } else {
          showConfirmModal(
            "Invalid Input",
            "Please enter ingredient in format: quantity unit name\nValid units: quantity, cups, tbsp, tsp, oz, lbs, g, ml, slices",
            () => {}
          );
        }
      }
    }

    function saveNewRecipe() {
      const name = document.getElementById("new-recipe-name").value.trim();
      const instructions = document.getElementById("new-recipe-instructions").value.trim();
      
      if (name && newRecipeIngredients.length > 0) {
        recipes.push({
          name: name,
          ingredients: [...newRecipeIngredients],
          instructions: instructions
        });
        renderRecipes();
        closeRecipeModal();
      } else {
        alert("Please provide a name and at least one ingredient.");
      }
    }

    function closeInventoryModal() {
      document.getElementById("inventoryModal").classList.remove("active");
    }

    function updateHomePage() {
      updateExpiringItems();
      updateLowInventory();
      updateRecipeSuggestions();
      updateInventoryOverview();
    }

    function updateExpiringItems() {
      const container = document.getElementById('expiring-items');
      container.innerHTML = '';
      
      const today = new Date();
      const expiringItems = [];
      
      // Collect all expiring items
      for (const invName in inventories) {
        inventories[invName].forEach(item => {
          if (item.expiry) {
            const expiryDate = new Date(item.expiry);
            const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
            if (daysUntilExpiry <= 3 && daysUntilExpiry >= 0) {
              expiringItems.push({
                ...item,
                inventory: invName,
                daysUntilExpiry
              });
            }
          }
        });
      }
      
      if (expiringItems.length === 0) {
        container.innerHTML = '<p class="no-items">No items expiring soon</p>';
        return;
      }
      
      // Sort by expiry date
      expiringItems.sort((a, b) => a.daysUntilExpiry - b.daysUntilExpiry);
      
      // Display items
      expiringItems.forEach(item => {
        const div = document.createElement('div');
        div.className = 'expiring-item';
        div.innerHTML = `
          <span class="item-name">${item.item}</span>
          <span class="item-details">
            ${item.quantity} ${item.measure} - ${item.inventory}
          </span>
          <span class="expiry-warning ${item.daysUntilExpiry === 0 ? 'expired' : 'expiring-soon'}">
            ${item.daysUntilExpiry === 0 ? 'Expires today!' : `Expires in ${item.daysUntilExpiry} days`}
          </span>
        `;
        container.appendChild(div);
      });
    }

    function updateLowInventory() {
      const container = document.getElementById('low-inventory');
      container.innerHTML = '';
      
      const lowItems = [];
      const LOW_THRESHOLD = 2; // Consider items with quantity <= 2 as low
      
      // Collect low inventory items
      for (const invName in inventories) {
        inventories[invName].forEach(item => {
          if (item.quantity <= LOW_THRESHOLD) {
            lowItems.push({
              ...item,
              inventory: invName
            });
          }
        });
      }
      
      if (lowItems.length === 0) {
        container.innerHTML = '<p class="no-items">No low inventory items</p>';
        return;
      }
      
      // Display items
      lowItems.forEach(item => {
        const div = document.createElement('div');
        div.className = 'low-item';
        div.innerHTML = `
          <span class="item-name">${item.item}</span>
          <span class="item-details">
            ${item.quantity} ${item.measure} - ${item.inventory}
          </span>
          <button onclick="addToShoppingList('${item.item}', ${item.quantity}, '${item.measure}')">
            Add to Shopping List
          </button>
        `;
        container.appendChild(div);
      });
    }

    function updateRecipeSuggestions() {
      const container = document.getElementById('recipe-suggestions');
      container.innerHTML = '';
      
      const inventoryItems = getAllInventoryItems();
      const suggestedRecipes = recipes.filter(recipe => {
        // Check if we have at least 70% of the ingredients
        const requiredIngredients = recipe.ingredients.length;
        const availableIngredients = recipe.ingredients.filter(ing => 
          inventoryItems.has(ing.name.toLowerCase())
        ).length;
        return (availableIngredients / requiredIngredients) >= 0.7;
      });
      
      if (suggestedRecipes.length === 0) {
        container.innerHTML = '<p class="no-items">No recipe suggestions available</p>';
        return;
      }
      
      // Display up to 3 suggested recipes
      suggestedRecipes.slice(0, 3).forEach(recipe => {
        const div = document.createElement('div');
        div.className = 'recipe-suggestion';
        div.innerHTML = `
          <h4>${recipe.name}</h4>
          <p>${recipe.ingredients.length} ingredients</p>
          <button onclick="showTab(4)">View Recipe</button>
        `;
        container.appendChild(div);
      });
    }

    function updateInventoryOverview() {
      const container = document.getElementById('inventory-overview');
      container.innerHTML = '';
      
      // Count items in each inventory
      const inventoryCounts = {};
      for (const invName in inventories) {
        inventoryCounts[invName] = inventories[invName].length;
      }
      
      // Display inventory counts
      for (const invName in inventoryCounts) {
        const div = document.createElement('div');
        div.className = 'inventory-count';
        div.innerHTML = `
          <span class="inventory-name">${invName}</span>
          <span class="item-count">${inventoryCounts[invName]} items</span>
          <button onclick="showInventory('${invName}')">View</button>
        `;
        container.appendChild(div);
      }
    }

    function addToShoppingList(item, quantity, measure) {
      shoppingList.push({
        name: item,
        quantity: quantity,
        measure: measure
      });
      updateShoppingList();
      showTab(3); // Switch to shopping list tab
    }

    updateGrid2();
    updateShoppingList();
  </script>
</body>
</html>
