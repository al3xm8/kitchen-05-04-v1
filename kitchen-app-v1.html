<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="kitchen-app-style.css"/>
  <title>Kitchen App</title>
</head>
<body>
  <div class="background">
    <div class="app">
      <div class="phone">

        <!-- HOME TAB -->
        <div class="tab-content active" id="tab1">
          <h2 class="tab-title">Home</h2>
          <div class="current-items-container">
            <h4>Current Items Across All Inventories:</h4>
            <ul id="current-items-list"></ul>
          </div>
        </div>

        <!-- INVENTORY TAB -->
        <div class="tab-content" id="tab2">
          <h2 class="tab-title">Inventory</h2>
          <div class="inventory-grid-view">
            <div class="new-inventory">
              <input type="text" id="new-inventory-name" placeholder="New Inventory Name" required />
              <button onclick="createNewInventory()">➕</button>
            </div>
            <div class="inventory-grid" id="inventory-grid"></div>
          </div>
          <div class="inventory-content" style="display: none;">
            <button onclick="showGrid2()">⬅</button>
            <h3 id="current-inventory-name"></h3>
            <form id="inventory-form" onsubmit="addToInventory2(event)">
              <input type="text" id="inv-item" placeholder="Item" required />
              <input type="number" id="inv-quantity" placeholder="Quantity" min="1" required />
              <select id="inv-measure" required>
                <option value="quantity">Quantity</option>
                <option value="ounces">Ounces</option>
                <option value="slices">Slices</option>
              </select>
              <input type="date" id="inv-expiry" placeholder="Expiration Date" />
              <button type="submit">➕</button>
            </form>
            <div class="inventory-items-container">
              <h4>Items in this inventory:</h4>
              <ul id="inventory"></ul>
            </div>
          </div>
        </div>

        <!-- SHOPPING LIST TAB -->
        <div class="tab-content" id="tab3">
          <h2 class="tab-title">Shopping Lists</h2>
          <button class="add-item-btn" onclick="showAddItemForm()">➕ Add Item</button>
          <div class="shopping-list-box">
            <h3>Items Needed:</h3>
            <ul id="shopping-list-items"></ul>
            <div class="purchase-controls">
              <button class="purchase-btn" onclick="handlePurchasedItems()" disabled>Move to Inventory</button>
            </div>
          </div>
        </div>

        <!-- RECIPES TAB -->
        <div class="tab-content" id="tab4">
          <h2 class="tab-title">Recipes</h2>
          <button onclick="renderRecipes()">🔄 Refresh</button>
          <button onclick="openRecipeModal()">➕ Add Recipe</button>
          <ul id="recipe-list"></ul>
        </div>

        <!-- PROFILE TAB -->
        <div class="tab-content" id="tab5">
          <h2 class="tab-title">Profile</h2>
        </div>

        <!-- TAB BAR -->
        <div class="tab-bar">
          <button class="active" onclick="showTab(1)">🏠<br>Home</button>
          <button onclick="showTab(2)">🥚<br>Inventory</button>
          <button onclick="showTab(3)">📋<br>Shopping List</button>
          <button onclick="showTab(4)">📖<br>Recipes</button>
          <button onclick="showTab(5)">👤<br>Profile</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Recipe Modal -->
  <div id="recipeModal" class="modal">
    <div class="modal-content">
      <h3>Add New Recipe</h3>
      <input type="text" id="new-recipe-name" placeholder="Recipe Name">
      <input type="text" id="new-ingredient" placeholder="Ingredient">
      <button onclick="addIngredientToNewRecipe()">Add Ingredient</button>
      <ul id="new-ingredients-list"></ul>
      <button onclick="saveNewRecipe()">Done</button>
      <button onclick="closeRecipeModal()">Cancel</button>
    </div>
  </div>

  <!-- Inventory Modal -->
  <div id="inventoryModal" class="modal" style="display:none;">
    <div class="modal-content">
      <p>Select inventory to move item into:</p>
      <div id="inventory-buttons"></div>
      <button onclick="closeInventoryModal()">Cancel</button>
    </div>
  </div>

  <script>
    const shoppingList = [
      { name: "Milk", quantity: 1, measure: "quantity" },
      { name: "Bread", quantity: 2, measure: "slices" },
      { name: "Eggs", quantity: 12, measure: "quantity" }
    ];
    const recipes = [
      { name: "Omelette", ingredients: ["Eggs", "Milk", "Salt"] },
      { name: "Pasta", ingredients: ["Pasta", "Tomato Sauce", "Olive Oil"] },
      { name: "Salad", ingredients: ["Lettuce", "Tomato", "Cucumber"] }
    ];
    let newRecipeIngredients = [];
    const inventories = { Fridge: [] };
    let currentInventory = 'Fridge';
    let inventory = inventories[currentInventory];

    function showTab(tabNum) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.getElementById('tab' + tabNum).classList.add('active');
      document.querySelectorAll('.tab-bar button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-bar button')[tabNum - 1].classList.add('active');
      if (tabNum === 1) updateCurrentItemsList();
      if (tabNum === 4) renderRecipes();
    }

    function updateGrid2() {
      const grid = document.getElementById('inventory-grid');
      grid.innerHTML = '';
      for (const name in inventories) {
        const div = document.createElement('div');
        div.className = 'inventory-item';
        div.textContent = name;
        div.onclick = () => showInventory(name);
        grid.appendChild(div);
      }
    }

    function createNewInventory() {
      const name = document.getElementById('new-inventory-name').value.trim();
      if (name && !inventories[name]) {
        inventories[name] = [];
        updateGrid2();
      }
    }

    function showInventory(name) {
      currentInventory = name;
      inventory = inventories[name];
      document.querySelector('.inventory-grid-view').style.display = 'none';
      document.querySelector('.inventory-content').style.display = 'block';
      document.getElementById('current-inventory-name').textContent = name;
      updateInventory();
    }

    function showGrid2() {
      document.querySelector('.inventory-grid-view').style.display = 'block';
      document.querySelector('.inventory-content').style.display = 'none';
    }

    function addToInventory2(event) {
      event.preventDefault();
      const item = document.getElementById('inv-item').value.trim();
      let quantity = parseInt(document.getElementById('inv-quantity').value || '1');
      const measure = document.getElementById('inv-measure').value;
      const expiry = document.getElementById('inv-expiry').value;
      const existing = inventory.find(i => i.item.toLowerCase() === item.toLowerCase() && i.measure === measure);
      if (existing) existing.quantity += quantity;
      else inventory.push({ item, quantity, measure, expiry });
      updateInventory();
      updateCurrentItemsList();
      document.getElementById('inventory-form').reset();
    }

    function updateInventory() {
      const list = document.getElementById('inventory');
      if (!list) return; // Guard against null if not on inventory tab
      
      list.innerHTML = '';
      if (!inventory) return; // Guard against null inventory
      
      inventory.forEach((entry, index) => {
        const li = document.createElement('li');
        const measureText = entry.measure === 'quantity' ? '' : ` ${entry.measure}`;
        
        // Create item display
        const itemDisplay = document.createElement('div');
        itemDisplay.className = 'item-display';
        itemDisplay.innerHTML = `
          <span class="item-name">${entry.item}</span>
          <span class="item-quantity">(${entry.quantity}${measureText})</span>
        `;
        
        // Create edit form (hidden by default)
        const editForm = document.createElement('div');
        editForm.className = 'edit-form';
        editForm.style.display = 'none';
        editForm.innerHTML = `
          <input type="text" class="edit-name" value="${entry.item}" placeholder="Item name" />
          <input type="number" class="edit-quantity" value="${entry.quantity}" min="1" placeholder="Quantity" />
          <select class="edit-measure">
            <option value="quantity" ${entry.measure === 'quantity' ? 'selected' : ''}>Quantity</option>
            <option value="ounces" ${entry.measure === 'ounces' ? 'selected' : ''}>Ounces</option>
            <option value="slices" ${entry.measure === 'slices' ? 'selected' : ''}>Slices</option>
          </select>
          <button class="save-edit">Save</button>
          <button class="cancel-edit">Cancel</button>
        `;
        
        // Create controls container
        const controls = document.createElement('div');
        controls.className = 'item-controls';
        
        // Edit button
        const editBtn = document.createElement('button');
        editBtn.textContent = '✏️';
        editBtn.onclick = () => {
          itemDisplay.style.display = 'none';
          editForm.style.display = 'flex';
          controls.style.display = 'none';
        };
        
        // Consume button
        const consumeBtn = document.createElement('button');
        consumeBtn.textContent = '🍽️';
        consumeBtn.onclick = () => {
          itemDisplay.style.display = 'none';
          consumeForm.style.display = 'flex';
          controls.style.display = 'none';
        };
        
        // Remove button
        const removeBtn = document.createElement('button');
        removeBtn.textContent = '🗑️';
        removeBtn.onclick = () => {
          inventory.splice(index, 1);
          updateInventory();
          updateCurrentItemsList();
        };
        
        controls.append(editBtn, consumeBtn, removeBtn);
        li.append(itemDisplay, editForm, controls);
        list.appendChild(li);
      });
    }

    function updateCurrentItemsList() {
      const list = document.getElementById("current-items-list");
      list.innerHTML = "";
      for (const invName in inventories) {
        inventories[invName].forEach(entry => {
          const li = document.createElement("li");
          const measureText = entry.measure === 'quantity' ? '' : ` ${entry.measure}`;
          const expiryText = entry.expiry ? ` - Expires: ${new Date(entry.expiry).toLocaleDateString()}` : '';
          li.textContent = `${entry.item} (${entry.quantity}${measureText})${expiryText} - ${invName}`;
          
          // Add expiry status class if item has expiry date
          if (entry.expiry) {
            const today = new Date();
            const expiryDate = new Date(entry.expiry);
            const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
            
            if (daysUntilExpiry < 0) {
              li.classList.add('expired');
            } else if (daysUntilExpiry <= 3) {
              li.classList.add('expiring-soon');
            }
          }
          
          list.appendChild(li);
        });
      }
    }

    function updateShoppingList() {
      const ul = document.getElementById("shopping-list-items");
      ul.innerHTML = "";
      shoppingList.forEach((item, index) => {
        const li = document.createElement("li");
        
        // Create checkbox
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'item-checkbox';
        checkbox.onchange = () => updatePurchaseButton();
        
        // Create item display
        const itemDisplay = document.createElement('div');
        itemDisplay.className = 'item-display';
        const measureText = item.measure === 'quantity' ? '' : ` ${item.measure}`;
        itemDisplay.innerHTML = `
          <span class="item-name">${item.name}</span>
          <span class="item-quantity">(${item.quantity}${measureText})</span>
        `;
        
        // Create edit form (hidden by default)
        const editForm = document.createElement('div');
        editForm.className = 'edit-form';
        editForm.style.display = 'none';
        editForm.innerHTML = `
          <input type="text" class="edit-name" value="${item.name}" placeholder="Item name" />
          <input type="number" class="edit-quantity" value="${item.quantity}" min="1" placeholder="Quantity" />
          <select class="edit-measure">
            <option value="quantity" ${item.measure === 'quantity' ? 'selected' : ''}>Quantity</option>
            <option value="ounces" ${item.measure === 'ounces' ? 'selected' : ''}>Ounces</option>
            <option value="slices" ${item.measure === 'slices' ? 'selected' : ''}>Slices</option>
          </select>
          <button class="save-edit">Save</button>
          <button class="cancel-edit">Cancel</button>
        `;
        
        // Create controls container
        const controls = document.createElement('div');
        controls.className = 'item-controls';
        
        // Edit button
        const editBtn = document.createElement('button');
        editBtn.textContent = '✏️';
        editBtn.onclick = () => {
          itemDisplay.style.display = 'none';
          editForm.style.display = 'flex';
          controls.style.display = 'none';
        };
        
        // Remove button
        const removeBtn = document.createElement('button');
        removeBtn.textContent = '🗑️';
        removeBtn.onclick = () => {
          shoppingList.splice(index, 1);
          updateShoppingList();
        };
        
        // Add event listeners for edit form
        editForm.querySelector('.save-edit').onclick = () => {
          const newName = editForm.querySelector('.edit-name').value.trim();
          const newQuantity = parseInt(editForm.querySelector('.edit-quantity').value) || 1;
          const newMeasure = editForm.querySelector('.edit-measure').value;
          if (newName && newQuantity > 0) {
            shoppingList[index] = {
              name: newName,
              quantity: newQuantity,
              measure: newMeasure
            };
            updateShoppingList();
          }
        };
        
        editForm.querySelector('.cancel-edit').onclick = () => {
          itemDisplay.style.display = 'flex';
          editForm.style.display = 'none';
          controls.style.display = 'flex';
        };
        
        controls.append(editBtn, removeBtn);
        li.append(checkbox, itemDisplay, editForm, controls);
        ul.appendChild(li);
      });
    }

    function updatePurchaseButton() {
      const checkedItems = document.querySelectorAll('.item-checkbox:checked');
      const purchaseBtn = document.querySelector('.purchase-btn');
      purchaseBtn.disabled = checkedItems.length === 0;
    }

    function handlePurchasedItems() {
      const checkedBoxes = document.querySelectorAll('.item-checkbox:checked');
      const itemsToMove = [];
      
      // Collect checked items
      checkedBoxes.forEach(checkbox => {
        const li = checkbox.closest('li');
        const index = Array.from(li.parentNode.children).indexOf(li);
        itemsToMove.push(shoppingList[index]);
      });
      
      // Create inventory selection modal
      const modal = document.getElementById("inventoryModal");
      const container = document.getElementById("inventory-buttons");
      container.innerHTML = "";
      
      // Add inventory selection buttons
      for (const name in inventories) {
        const btn = document.createElement("button");
        btn.textContent = name;
        btn.onclick = () => {
          // Move items to selected inventory
          itemsToMove.forEach(item => {
            // Check if item already exists in inventory
            const existingItem = inventories[name].find(i => 
              i.item.toLowerCase() === item.name.toLowerCase() && 
              i.measure === item.measure
            );
            
            if (existingItem) {
              // If item exists, add to its quantity
              existingItem.quantity += item.quantity;
            } else {
              // If item doesn't exist, add new entry
              inventories[name].push({
                item: item.name,
                quantity: item.quantity,
                measure: item.measure
              });
            }
          });
          
          // Remove moved items from shopping list
          const indicesToRemove = [];
          checkedBoxes.forEach(checkbox => {
            const li = checkbox.closest('li');
            const index = Array.from(li.parentNode.children).indexOf(li);
            indicesToRemove.push(index);
          });
          
          // Remove items in reverse order to avoid index issues
          indicesToRemove.sort((a, b) => b - a).forEach(index => {
            shoppingList.splice(index, 1);
          });
          
          modal.style.display = "none";
          updateShoppingList();
          updateGrid2(); // Update inventory grid
          if (currentInventory === name) {
            updateInventory(); // Update current inventory view
          }
          updateCurrentItemsList();
        };
        container.appendChild(btn);
      }
      
      modal.style.display = "flex";
    }

    function showAddItemForm() {
      const ul = document.getElementById("shopping-list-items");
      const li = document.createElement("li");
      li.className = "new-item-form";
      
      const form = document.createElement('div');
      form.className = 'edit-form';
      form.innerHTML = `
        <input type="text" class="edit-name" placeholder="Enter new item" />
        <input type="number" class="edit-quantity" value="1" min="1" placeholder="Quantity" />
        <select class="edit-measure">
          <option value="quantity">Quantity</option>
          <option value="ounces">Ounces</option>
          <option value="slices">Slices</option>
        </select>
        <button class="save-edit">Add</button>
        <button class="cancel-edit">Cancel</button>
      `;
      
      form.querySelector('.save-edit').onclick = () => {
        const newName = form.querySelector('.edit-name').value.trim();
        const newQuantity = parseInt(form.querySelector('.edit-quantity').value) || 1;
        const newMeasure = form.querySelector('.edit-measure').value;
        if (newName && newQuantity > 0) {
          shoppingList.push({
            name: newName,
            quantity: newQuantity,
            measure: newMeasure
          });
          updateShoppingList();
        }
      };
      
      form.querySelector('.cancel-edit').onclick = () => {
        li.remove();
      };
      
      li.appendChild(form);
      ul.insertBefore(li, ul.firstChild);
      form.querySelector('.edit-name').focus();
    }

    function getAllInventoryItems() {
      const items = new Set();
      for (const invName in inventories) {
        inventories[invName].forEach(entry => items.add(entry.item.toLowerCase()));
      }
      return items;
    }

    function renderRecipes() {
      const list = document.getElementById("recipe-list");
      list.innerHTML = '';
      const inventoryItems = getAllInventoryItems();
      recipes.forEach((recipe, index) => {
        const li = document.createElement("li");
        li.innerHTML = `<strong>${recipe.name}</strong>: `;
        const hasAll = recipe.ingredients.every(i => inventoryItems.has(i.toLowerCase()));
        li.innerHTML += hasAll ? "✅" : "❌";
        li.title = `Needs: ${recipe.ingredients.join(', ')}`;

        const ingredientsList = document.createElement("ul");
        recipe.ingredients.forEach(ing => {
          const ingLi = document.createElement("li");
          ingLi.textContent = ing;
          ingredientsList.appendChild(ingLi);
        });

        const removeBtn = document.createElement("button");
        removeBtn.textContent = "🗑 Remove";
        removeBtn.onclick = () => { recipes.splice(index, 1); renderRecipes(); };

        li.appendChild(ingredientsList);
        li.appendChild(removeBtn);
        list.appendChild(li);
      });
    }

    function openRecipeModal() {
      newRecipeIngredients = [];
      document.getElementById("new-recipe-name").value = '';
      document.getElementById("new-ingredient").value = '';
      document.getElementById("new-ingredients-list").innerHTML = '';
      document.getElementById("recipeModal").style.display = "block";
    }

    function closeRecipeModal() {
      document.getElementById("recipeModal").style.display = "none";
    }

    function addIngredientToNewRecipe() {
      const input = document.getElementById("new-ingredient");
      const ing = input.value.trim();
      if (ing) {
        newRecipeIngredients.push(ing);
        const li = document.createElement("li");
        li.textContent = ing;
        document.getElementById("new-ingredients-list").appendChild(li);
        input.value = '';
      }
    }

    function saveNewRecipe() {
      const name = document.getElementById("new-recipe-name").value.trim();
      if (name && newRecipeIngredients.length > 0) {
        recipes.push({ name: name, ingredients: [...newRecipeIngredients] });
        renderRecipes();
        closeRecipeModal();
      } else {
        alert("Please provide a name and at least one ingredient.");
      }
    }

    function closeInventoryModal() {
      document.getElementById("inventoryModal").style.display = "none";
    }

    updateGrid2();
    updateShoppingList();
  </script>
</body>
</html>
